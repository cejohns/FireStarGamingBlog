<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Firestar Gaming</title>
    <script type="module" src="adminApi.js"></script>
    <link rel="stylesheet" href="admin_panel.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">
            <span>Firestar Gaming Admin</span>
        </div>
        <nav>
            <a href="index.html">View Website</a>
            <a href="logout.html">Logout</a>
        </nav>
    </header>

    <aside class="sidebar">
        <ul>
            <li><a href="#dashboard">Dashboard</a></li>
            <li><a href="#content-management">Content Management</a></li>
            <li><a href="#analytics">Analytics</a></li>
            <li><a href="#comments-moderation">Comments Moderation</a></li>
        </ul>
    </aside>

    <main>
        <section id="dashboard">
            <h1>Dashboard</h1>
            <p>Welcome, Admin! Here's a summary of the website activity.</p>
        </section>

        <section id="content-management">
            <h2>Content Management</h2>
            <button id="show-add-post-form">Add New Post</button>
            
            <form id="add-post-form" style="display: none;">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" required>
                
                <label for="summary">Summary:</label>
                <textarea id="summary" name="summary" required></textarea>
                
                <label for="content">Content:</label>
                <textarea id="content" name="content" rows="10" required></textarea>
                
                <label for="category">Category:</label>
                <select id="category" name="category" required>
                    <option value="Video Games">Video Games</option>
                    <option value="Game Development">Game Development</option>
                    <option value="New Tech">New Tech</option>
                </select>
                
                <button type="submit">Submit Post</button>
            </form>
            
            <div class="posts">
                <!-- List of posts fetched from the backend -->
            </div>
            <section id="admin-posts">
                <h2>Manage Posts</h2>
                <div id="posts-container">
                    <!-- Posts will be dynamically inserted here -->
                </div>
            </section>
        

            <section id="analytics">
                <h2>Analytics</h2>
                <p id="total-posts">Total Posts: Loading...</p>
                <p id="total-comments">Total Comments: Loading...</p>
                <h3>Popular Posts:</h3>
                <div id="popular-posts"></div>
            </section>
            

            <section id="comments-moderation">
                <h2>Comments Moderation</h2>
                <div id="comments-container">
                    <!-- Comments will be dynamically loaded here -->
                </div>
            </section>
            
    </main>

    <footer>
        <p>&copy; 2025 Firestar Gaming. Admin Panel.</p>
    </footer>

       <!-- Add JavaScript here -->
       <script type="module">
        import { addPost } from './adminApi.js';
    
        // Fetch and display posts
        async function fetchAndRenderPosts() {
            try {
                const response = await fetch('https://localhost:3001/api/posts'); // Adjust the URL if necessary
                if (!response.ok) {
                    throw new Error('Failed to fetch posts');
                }
                const posts = await response.json();
                renderPosts(posts);
            } catch (error) {
                console.error('Error fetching posts:', error);
                const container = document.getElementById('posts-container');
                container.innerHTML = '<p>Failed to load posts. Please try again later.</p>';
            }
        }
    
        // Render posts inside the posts container
        function renderPosts(posts) {
            const container = document.getElementById('posts-container');
            container.innerHTML = ''; // Clear existing posts
    
            if (posts.length === 0) {
                container.innerHTML = '<p>No posts available.</p>';
                return;
            }
    
            posts.forEach((post) => {
                const postElement = document.createElement('div');
                postElement.classList.add('post');
                postElement.innerHTML = `
                    <h3>${post.title}</h3>
                    <p><strong>Category:</strong> ${post.category}</p>
                    <p><strong>Summary:</strong> ${post.summary}</p>
                    <a href="BlogPost.html?id=${post._id}" class="view-post">View Post</a>
                    <button class="edit-post" data-id="${post._id}">Edit</button>
                    <button class="delete-post" data-id="${post._id}">Delete</button>
                `;
                container.appendChild(postElement);
            });
    
            // Add event listeners to "Edit" and "Delete" buttons
            document.querySelectorAll('.edit-post').forEach((button) =>
                button.addEventListener('click', handleEditPost)
            );
            document.querySelectorAll('.delete-post').forEach((button) =>
                button.addEventListener('click', handleDeletePost)
            );
        }
    
        // Handle post deletion
        async function handleDeletePost(event) {
            const postId = event.target.dataset.id;
    
            if (confirm('Are you sure you want to delete this post?')) {
                try {
                    const response = await fetch(`https://localhost:3001/api/posts/${postId}`, {
                        method: 'DELETE',
                    });
                    if (!response.ok) {
                        throw new Error('Failed to delete post');
                    }
                    alert('Post deleted successfully!');
                    fetchAndRenderPosts(); // Refresh the posts list
                } catch (error) {
                    alert('Failed to delete post: ' + error.message);
                }
            }
        }
    
        // Placeholder for edit functionality
        function handleEditPost(event) {
            const postId = event.target.dataset.id;
            alert(`Edit functionality for Post ID: ${postId} is not yet implemented.`);
        }
    
        // Fetch and render posts on page load
        document.addEventListener('DOMContentLoaded', fetchAndRenderPosts);
    
        // Toggle visibility of the Add Post form
        document.getElementById('show-add-post-form').addEventListener('click', () => {
            const form = document.getElementById('add-post-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });
    
        // Handle Add Post form submission
        document.getElementById('add-post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
    
            const title = document.getElementById('title').value;
            const summary = document.getElementById('summary').value;
            const content = document.getElementById('content').value;
            const category = document.getElementById('category').value;
    
            try {
                const result = await addPost({ title, summary, content, category });
                if (result) {
                    alert('Post added successfully!');
                    document.getElementById('add-post-form').reset();
                    document.getElementById('add-post-form').style.display = 'none';
                    fetchAndRenderPosts(); // Refresh posts list
                }
            } catch (error) {
                alert('Failed to add post: ' + error.message);
            }
        });

        async function fetchAndRenderAnalytics() {
    try {
        const response = await fetch('https://localhost:3001/api/analytics');
        if (!response.ok) throw new Error('Failed to fetch analytics');
        
        const data = await response.json();
        document.getElementById('total-posts').textContent = `Total Posts: ${data.totalPosts}`;
        document.getElementById('total-comments').textContent = `Total Comments: ${data.totalComments}`;
        
        const popularContainer = document.getElementById('popular-posts');
        popularContainer.innerHTML = '';
        data.popularPosts.forEach(post => {
            const postElement = document.createElement('p');
            postElement.textContent = post.title;
            popularContainer.appendChild(postElement);
        });
    } catch (error) {
        console.error('Error fetching analytics:', error);
    }
}

document.addEventListener('DOMContentLoaded', fetchAndRenderAnalytics);


async function fetchAndRenderComments() {
    try {
        const response = await fetch('http://localhost:3001/api/comments');
        if (!response.ok) throw new Error('Failed to fetch comments');
        
        const comments = await response.json();
        const commentsContainer = document.getElementById('comments-container');
        commentsContainer.innerHTML = '';
        
        comments.forEach(comment => {
            const commentElement = document.createElement('div');
            commentElement.classList.add('comment');
            commentElement.innerHTML = `
                <p><strong>${comment.author}:</strong> ${comment.text}</p>
                <button class="delete-comment" data-id="${comment._id}">Delete</button>
            `;
            commentsContainer.appendChild(commentElement);
        });
        
        document.querySelectorAll('.delete-comment').forEach(button =>
            button.addEventListener('click', handleDeleteComment)
        );
    } catch (error) {
        console.error('Error fetching comments:', error);
    }
}

async function handleDeleteComment(event) {
    const commentId = event.target.dataset.id;
    if (confirm('Are you sure you want to delete this comment?')) {
        try {
            const response = await fetch(`http://localhost:3001/api/comments/${commentId}`, {
                method: 'DELETE',
            });
            if (!response.ok) throw new Error('Failed to delete comment');
            alert('Comment deleted successfully');
            fetchAndRenderComments();
        } catch (error) {
            alert('Failed to delete comment: ' + error.message);
        }
    }
}

document.addEventListener('DOMContentLoaded', fetchAndRenderComments);

    </script>
    
    
</body>
</html>
