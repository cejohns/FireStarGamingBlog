<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Firestar Gaming</title>
    <link rel="stylesheet" href="admin_panel.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <div class="logo">
        <span>Firestar Gaming Admin</span>
    </div>
    <nav>
        <a href="index.html">View Website</a>
        <a href="logout.html">Logout</a>
    </nav>
</header>

<aside class="sidebar">
    <ul>
        <li><a href="#dashboard">Dashboard</a></li>
        <li><a href="#content-management">Content Management</a></li>
        <li><a href="#analytics">Analytics</a></li>
        <li><a href="#comments-moderation">Comments Moderation</a></li>
    </ul>
</aside>

<main>
    <!-- DASHBOARD -->
    <section id="dashboard">
        <h1>Dashboard</h1>
        <p>Welcome, Admin! Here's a summary of the website activity.</p>
    </section>

    <!-- CONTENT MANAGEMENT -->
    <section id="content-management">
        <h2>Content Management</h2>

        <button id="publish-button" class="publish-button">Publish</button> <!-- ‚úÖ Add this button here -->
        
        <div class="tabs">
            <button class="tab-btn active" data-target="posts">Blog Posts</button>
            <button class="tab-btn" data-target="reviews">Game Reviews</button>
            <button class="tab-btn" data-target="tutorials">Tutorials</button>
            <button class="tab-btn" data-target="galleries">Picture Galleries</button>
            <button class="tab-btn" data-target="videos">Videos</button>
        </div>

        <div class="content-container">
            <!-- Blog Posts -->
            <div class="content-section" id="posts">
                <button id="show-add-post-form">Add New Post</button>
                <form id="add-post-form" style="display: none;">
                    <label for="title">Title:</label>
                    <input type="text" id="title" required>
                
                    <label for="author">Author:</label>
                    <input type="text" id="author" required>
                
                    <label for="summary">Summary:</label>
                    <textarea id="summary" required></textarea>
                
                    <label for="content">Content:</label>
                    <textarea id="content" required></textarea>
                
                    <label for="category">Category:</label>
                    <select id="category" required>
                        <option value="Video Games">Video Games</option>
                        <option value="Game Development">Game Development</option>
                        <option value="New Tech">New Tech</option>
                    </select>
                
                    <button type="submit">Submit Post</button>
                </form>
                
                <div id="posts-container"></div>
            </div>

          <!-- Game Reviews -->
<div class="content-section" id="reviews" style="display: none;">
    <button id="show-add-review-form">Add Review</button>
    <form id="add-review-form">
        <label for="review-title">Title:</label>
        <input type="text" id="review-title" name="title" required>
    
        <label for="review-author">Author:</label>
        <input type="text" id="review-author" name="author" required>
    
        <label for="review-summary">Summary:</label>
        <textarea id="review-summary" name="summary" required></textarea>
    
        <label for="review-content">Content:</label>
        <textarea id="review-content" name="content" required></textarea>
    
        <label for="review-rating">Rating (0-10):</label>
        <input type="number" id="review-rating" name="rating" min="0" max="10" required>
    
        <label for="review-category">Category:</label>
        <select id="review-category" name="category" required>
            <option value="">Select Category</option>
            <option value="Video Games">Video Games</option>
            <option value="Technology">Technology</option>
            <option value="Gaming Hardware">Gaming Hardware</option>
        </select>
    
        <button type="submit">Submit Review</button>
    </form>

    <div id="reviews-container"></div>
</div>

            <!-- Tutorials -->
            <div class="content-section" id="tutorials" style="display: none;">
                <button id="show-add-tutorial-form">Add Tutorial</button>
                <form id="add-tutorial-form">
                    <label for="tutorial-title">Title:</label>
                    <input type="text" id="tutorial-title" name="title" required>
                
                    <label for="tutorial-author">Author:</label>
                    <input type="text" id="tutorial-author" name="author" required>
                
                    <label for="tutorial-summary">Summary:</label>
                    <textarea id="tutorial-summary" name="summary" required></textarea>
                
                    <label for="tutorial-content">Tutorial Content:</label>
                    <textarea id="tutorial-content" name="content" required></textarea>
                
                    <label for="tutorial-category">Category:</label>
                    <select id="tutorial-category" name="category" required>
                        <option value="">-- Select Category --</option>
                        <option value="Video Games">Video Games</option>
                        <option value="Game Development">Game Development</option>
                        <option value="New Tech">New Tech</option>
                    </select>
                
                    <button type="submit">Submit Tutorial</button>
                </form>
                
                
                <div id="tutorials-container"></div>
            </div>
<!-- Edit Post Form -->
<form id="edit-post-form" style="display: none;">
    <h3>Edit Post</h3>
    <label for="edit-post-title">Title:</label>
    <input type="text" id="edit-post-title" name="title" required>

    <label for="edit-post-author">Author:</label>
    <input type="text" id="edit-post-author" name="author" required>

    <label for="edit-post-summary">Summary:</label>
    <textarea id="edit-post-summary" name="summary" required></textarea>

    <label for="edit-post-content">Content:</label>
    <textarea id="edit-post-content" name="content" required></textarea>

    <label for="edit-post-category">Category:</label>
    <select id="edit-post-category" name="category" required>
        <option value="Video Games">Video Games</option>
        <option value="Game Development">Game Development</option>
        <option value="New Tech">New Tech</option>
    </select>

    <button type="submit">Update Post</button>
</form>

<!-- Edit Review Form -->
<form id="edit-review-form" style="display: none;">
    <h3>Edit Review</h3>
    <label for="edit-review-title">Title:</label>
    <input type="text" id="edit-review-title" name="title" required>

    <label for="edit-review-author">Author:</label>
    <input type="text" id="edit-review-author" name="author" required>

    <label for="edit-review-summary">Summary:</label>
    <textarea id="edit-review-summary" name="summary" required></textarea>

    <label for="edit-review-content">Content:</label>
    <textarea id="edit-review-content" name="content" required></textarea>

    <label for="edit-review-rating">Rating (0-10):</label>
    <input type="number" id="edit-review-rating" name="rating" min="0" max="10" required>

    <label for="edit-review-category">Category:</label>
    <select id="edit-review-category" name="category" required>
        <option value="Video Games">Video Games</option>
        <option value="Technology">Technology</option>
        <option value="Gaming Hardware">Gaming Hardware</option>
    </select>

    <button type="submit">Update Review</button>
</form>

<!-- Edit Tutorial Form -->
<form id="edit-tutorial-form" style="display: none;">
    <h3>Edit Tutorial</h3>
    <label for="edit-tutorial-title">Title:</label>
    <input type="text" id="edit-tutorial-title" name="title" required>

    <label for="edit-tutorial-author">Author:</label>
    <input type="text" id="edit-tutorial-author" name="author" required>

    <label for="edit-tutorial-summary">Summary:</label>
    <textarea id="edit-tutorial-summary" name="summary" required></textarea>

    <label for="edit-tutorial-content">Tutorial Content:</label>
    <textarea id="edit-tutorial-content" name="content" required></textarea>

    <label for="edit-tutorial-category">Category:</label>
    <select id="edit-tutorial-category" name="category" required>
        <option value="Video Games">Video Games</option>
        <option value="Game Development">Game Development</option>
        <option value="New Tech">New Tech</option>
    </select>

    <button type="submit">Update Tutorial</button>
</form>

            <!-- Picture Galleries -->
            <div class="content-section" id="galleries" style="display: none;">
                <button id="show-add-gallery-form">Add Picture</button>
                <form id="add-gallery-form">
                    <input type="text" id="gallery-title" placeholder="Title" required />
                    <input type="file" id="gallery-image"name="image" accept="image/*"  required />
                    <button type="submit">Upload Image</button>
                </form>
                <div id="galleries-container"></div> 
                </div>
                
            </div>
            <form id="edit-gallery-form" style="display: none;">
                <input type="hidden" id="edit-gallery-id" />
            
                <label for="edit-gallery-title">Title:</label>
                <input type="text" id="edit-gallery-title" required />
            
                <label for="edit-gallery-image">Change Image (optional):</label>
                <input type="file" id="edit-gallery-image" accept="image/*" />
            
                <button type="submit">Update Image</button>
            </form>
            
            <!-- Videos -->
            <div class="content-section" id="videos" style="display: none;">
                <button id="show-add-video-form">Add Video</button>
                <form id="add-video-form" style="display: none;">
                    <label for="video-title">Title:</label>
                    <input type="text" id="video-title" required>

                    <label for="video-file">Upload Video:</label>
                    <input type="file" id="video-file" accept="video/*" required>

                    <button type="submit">Submit Video</button>
                </form>
                <div id="videos-container"></div>
            </div>
        </div>
        <form id="edit-video-form" style="display: none;">
            <input type="hidden" id="edit-video-id" />
        
            <label for="edit-video-title">Title:</label>
            <input type="text" id="edit-video-title" required />
        
            <label for="edit-video-file">Replace Video (optional):</label>
            <input type="file" id="edit-video-file" accept="video/*" />
        
            <button type="submit">Update Video</button>
        </form>
        
    </section>

    <!-- üîß Edit Sidebar as Section -->
<section id="edit-sidebar" class="edit-sidebar" style="display: none;">
    <div class="sidebar-header">
        <h2>Edit Content</h2>
        <button id="close-sidebar" class="close-btn" title="Close">‚úñ</button>
    </div>
    <div id="edit-form-wrapper"></div>
</section>

    

    <!-- ANALYTICS -->
    <section id="analytics">
        <h2>Analytics</h2>
        <p id="total-posts">Total Posts: Loading...</p>
        <p id="total-comments">Total Comments: Loading...</p>
        <h3>Popular Posts:</h3>
        <div id="popular-posts"></div>
    </section>

    <!-- COMMENTS MODERATION -->
    <section id="comments-moderation">
        <h2>Comments Moderation</h2>
        <div id="comments-container"></div>
    </section>
</main>

<footer>
    <p>&copy; 2025 Firestar Gaming. Admin Panel.</p>
</footer>



<script type="module">
    import { uploadImage, addContent, fetchContent } from "./adminApi.js";
  
    document.addEventListener("DOMContentLoaded", () => {
        console.log("‚úÖ adminApi.js loaded successfully!");
  
        // ‚úÖ Toggle tabs functionality
        document.querySelectorAll(".tab-btn").forEach(button => {
            button.addEventListener("click", () => {
                document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
                button.classList.add("active");
  
                document.querySelectorAll(".content-section").forEach(section => {
                    section.style.display = "none";
                });
  
                const targetSection = document.getElementById(button.dataset.target);
                if (targetSection) {
                    targetSection.style.display = "block";
                } else {
                    console.warn(`‚ö† Target section "${button.dataset.target}" not found.`);
                }
            });


            document.getElementById("close-sidebar").addEventListener("click", () => {
    const sidebar = document.getElementById("edit-sidebar");
    const wrapper = document.getElementById("edit-form-wrapper");

    sidebar.style.display = "none";
    wrapper.innerHTML = ""; // clear any loaded form
});

        });
  
        // ‚úÖ Toggle visibility of add forms
        document.querySelectorAll("[id^=show-add]").forEach(button => {
            button.addEventListener("click", () => {
                const formId = button.id.replace("show-", "");
                const form = document.getElementById(formId);
  
                if (form) {
                    form.style.display = form.style.display === "none" ? "block" : "none";
                } else {
                    console.warn(`‚ö† Form "${formId}" not found.`);
                }
            });
        });
  
        // ‚úÖ Handle gallery form submission
        const galleryForm = document.getElementById("add-gallery-form");
        if (galleryForm) {
            galleryForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const titleInput = document.getElementById("gallery-title");
    const imageInput = document.getElementById("gallery-image");
    const previewImage = document.getElementById("previewImage");

    if (imageInput && previewImage) {
    imageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewImage.style.display = "block";
            };
            reader.readAsDataURL(file);
        } else {
            previewImage.style.display = "none";
        }
    });
}

    if (!titleInput || !imageInput) {
        alert("‚ö† Missing required input fields!");
        return;
    }

    const title = titleInput.value.trim();
    const imageFile = imageInput.files[0];

    if (!title || !imageFile) {
        alert("‚ö† Title and image file are required!");
        return;
    }

    const formData = new FormData();
    formData.append("title", title);
    formData.append("image", imageFile); // ‚úÖ Must match Multer field name in backend

    console.log("üì§ Uploading image...");
    for (let [key, value] of formData.entries()) {
        console.log(`${key}:`, value);
    }

    try {
        const response = await fetch("http://localhost:3000/api/galleries", {
            method: "POST",
            body: formData,
        });

        if (!response.ok) {
            const errText = await response.text();
            throw new Error("Failed to add galleries: " + errText);
        }

        alert("‚úÖ Image uploaded successfully!");
        galleryForm.reset();
        fetchContent("galleries", "galleries-container");
    } catch (error) {
        console.error("‚ùå Error adding gallery image:", error);
        alert("‚ùå Error adding gallery image: " + error.message);
    }


            });
        } else {
            console.warn("‚ö† Gallery form not found.");
        }
    });

    const videoForm = document.getElementById("add-video-form");
if (videoForm) {
    videoForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const titleInput = document.getElementById("video-title");
        const videoInput = document.getElementById("video-file");

        if (!titleInput || !videoInput) {
            alert("‚ö† Missing required input fields!");
            return;
        }

        const title = titleInput.value.trim();
        const videoFile = videoInput.files[0];

        if (!title || !videoFile) {
            alert("‚ö† Title and video file are required!");
            return;
        }

        const formData = new FormData();
        formData.append("title", title);
        formData.append("video", videoFile); // ‚úÖ Must match Multer field name on server

        console.log("üì§ Uploading video...");
        for (let [key, value] of formData.entries()) {
            console.log(`${key}:`, value);
        }

        try {
            const response = await fetch("http://localhost:3000/api/videos", {
                method: "POST",
                body: formData,
            });

            if (!response.ok) {
                const errText = await response.text();
                throw new Error("Failed to add video: " + errText);
            }

            alert("‚úÖ Video uploaded successfully!");
            videoForm.reset();
            fetchContent("videos", "videos-container");
        } catch (error) {
            console.error("‚ùå Error uploading video:", error);
            alert("‚ùå Error uploading video: " + error.message);
        }
    });
} else {
    console.warn("‚ö† Video form not found.");
}

// üìÑ Show & fill Edit Post Form
window.showEditPostForm = function(post) {
    const form = document.getElementById("edit-post-form");
    form.style.display = "block";

    document.getElementById("edit-post-title").value = post.title;
    document.getElementById("edit-post-author").value = post.author;
    document.getElementById("edit-post-summary").value = post.summary;
    document.getElementById("edit-post-content").value = post.content;
    document.getElementById("edit-post-category").value = post.category;

    // Store post ID in a dataset or global var
    form.dataset.id = post._id;
};

// üéÆ Show & fill Edit Review Form
window.showEditReviewForm = function(review) {
    const form = document.getElementById("edit-review-form");
    form.style.display = "block";

    document.getElementById("edit-review-title").value = review.title;
    document.getElementById("edit-review-author").value = review.author;
    document.getElementById("edit-review-summary").value = review.summary;
    document.getElementById("edit-review-content").value = review.content;
    document.getElementById("edit-review-rating").value = review.rating;
    document.getElementById("edit-review-category").value = review.category;

    form.dataset.id = review._id;
};

// üß† Show & fill Edit Tutorial Form
window.showEditTutorialForm = function(tutorial) {
    const form = document.getElementById("edit-tutorial-form");
    form.style.display = "block";

    document.getElementById("edit-tutorial-title").value = tutorial.title;
    document.getElementById("edit-tutorial-author").value = tutorial.author;
    document.getElementById("edit-tutorial-summary").value = tutorial.summary;
    document.getElementById("edit-tutorial-content").value = tutorial.content;
    document.getElementById("edit-tutorial-category").value = tutorial.category;

    form.dataset.id = tutorial._id;
};

window.showEditGalleryForm = function (gallery) {
    const form = document.getElementById("edit-gallery-form");
    form.style.display = "block";

    document.getElementById("edit-gallery-id").value = gallery._id;
    document.getElementById("edit-gallery-title").value = gallery.title;
};
window.showEditVideoForm = function (video) {
    const form = document.getElementById("edit-video-form");
    form.style.display = "block";

    document.getElementById("edit-video-id").value = video._id;
    document.getElementById("edit-video-title").value = video.title;
};




// ‚úèÔ∏è Edit Post Submit
document.getElementById("edit-post-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const id = e.target.dataset.id;
    const payload = {
        title: document.getElementById("edit-post-title").value,
        author: document.getElementById("edit-post-author").value,
        summary: document.getElementById("edit-post-summary").value,
        content: document.getElementById("edit-post-content").value,
        category: document.getElementById("edit-post-category").value,
    };

    try {
        const response = await fetch(`http://localhost:3000/api/posts/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        });

        if (!response.ok) throw new Error("Failed to update post");

        alert("‚úÖ Post updated!");
        e.target.reset();
        e.target.style.display = "none";
        fetchContent("posts", "posts-container");
    } catch (err) {
        console.error("‚ùå Error updating post:", err);
        alert("‚ùå " + err.message);
    }
});

// ‚úèÔ∏è Edit Review Submit
document.getElementById("edit-review-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const id = e.target.dataset.id;
    const payload = {
        title: document.getElementById("edit-review-title").value,
        author: document.getElementById("edit-review-author").value,
        summary: document.getElementById("edit-review-summary").value,
        content: document.getElementById("edit-review-content").value,
        rating: parseFloat(document.getElementById("edit-review-rating").value),
        category: document.getElementById("edit-review-category").value,
    };

    try {
        const response = await fetch(`http://localhost:3000/api/reviews/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        });

        if (!response.ok) throw new Error("Failed to update review");

        alert("‚úÖ Review updated!");
        e.target.reset();
        e.target.style.display = "none";
        fetchContent("reviews", "reviews-container");
    } catch (err) {
        console.error("‚ùå Error updating review:", err);
        alert("‚ùå " + err.message);
    }
});

// ‚úèÔ∏è Edit Tutorial Submit
document.getElementById("edit-tutorial-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const id = e.target.dataset.id;
    const payload = {
        title: document.getElementById("edit-tutorial-title").value,
        author: document.getElementById("edit-tutorial-author").value,
        summary: document.getElementById("edit-tutorial-summary").value,
        content: document.getElementById("edit-tutorial-content").value,
        category: document.getElementById("edit-tutorial-category").value,
    };

    try {
        const response = await fetch(`http://localhost:3000/api/tutorials/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        });

        if (!response.ok) throw new Error("Failed to update tutorial");

        alert("‚úÖ Tutorial updated!");
        e.target.reset();
        e.target.style.display = "none";
        fetchContent("tutorials", "tutorials-container");
    } catch (err) {
        console.error("‚ùå Error updating tutorial:", err);
        alert("‚ùå " + err.message);
    }
});

document.getElementById("edit-gallery-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const id = document.getElementById("edit-gallery-id").value;
    const title = document.getElementById("edit-gallery-title").value.trim();
    const imageFile = document.getElementById("edit-gallery-image").files[0];

    const formData = new FormData();
    formData.append("title", title);
    if (imageFile) formData.append("image", imageFile);

    try {
        const response = await fetch(`http://localhost:3000/api/galleries/${id}`, {
            method: "PUT",
            body: formData,
        });

        if (!response.ok) throw new Error("Failed to update gallery");

        alert("‚úÖ Gallery updated!");
        e.target.reset();
        e.target.style.display = "none";
        fetchContent("galleries", "galleries-container");
    } catch (err) {
        console.error("‚ùå Error:", err);
        alert("‚ùå " + err.message);
    }
});
document.getElementById("edit-video-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const id = document.getElementById("edit-video-id").value;
    const title = document.getElementById("edit-video-title").value.trim();
    const videoFile = document.getElementById("edit-video-file").files[0];

    const formData = new FormData();
    formData.append("title", title);
    if (videoFile) formData.append("video", videoFile);

    try {
        const response = await fetch(`http://localhost:3000/api/videos/${id}`, {
            method: "PUT",
            body: formData,
        });

        if (!response.ok) throw new Error("Failed to update video");

        alert("‚úÖ Video updated!");
        e.target.reset();
        e.target.style.display = "none";
        fetchContent("videos", "videos-container");
    } catch (err) {
        console.error("‚ùå Error:", err);
        alert("‚ùå " + err.message);
    }
});


  </script>
  ...
  <script type="module" src="adminApi.js"></script>
  </body>
  

</body>
</html>